---
layout: post
title: Notes of APUE 5
---

#{{ page.title }}  
<p class="meta">12 Oct 2014 - Guangzhou</p>   
+++++++++++++++++  

##[返回主目录][]  
<br>

##Chapter 5: 标准I/O库
1. 引言  
    标准I/O库处理很多细节，例如缓冲区分配，以“优化长度”执行I/O等等，这些处理使得用户不必担心如何选择正确的块长度。  
    标准I/O库由Dennis Ritchie在1975年左右编写，30年后只做极小修改。  
2. 流和FILE对象  
    在chapter 3，所有的I/O函数都是针对文件描述符fd的。而对于标准I/O库，它们的操作则是围绕**流(stream)**进行的。  
    标准文件流可用于单字节或多字节（“宽”）字符集。  
    **流的定向**决定所读、写的字符是单字节还是多字节。若在未定向的流使用一个多字节I/O函数，则流的定向设置为“宽定向”；若使用一个单字节I/O函数，则流的定向设置为“字节定向”。  
    只有两个函数可以改变流的定向。freopen函数清除流的定向（5.5节），fwide函数设置流的定向。  

    ```c
    #include <stdio.h>
    #include <wchar.h>
    
    int fwide(FILE *fp, int mode);
    /* 返回值：流是宽定向则返回正值，字节定向返回负值，未定向返回0 */
    ```
    根据mode参数的不同，fwide()执行不同工作：  
    * mode 负，fwide()试图设置指定的流是字节定向的。
    * mode 正，。。。。。。。。。。。。。宽定向的。
    * mode 0，fwide()不设置流的定向，返回原来标识该流定向的值。  

    fwide()不改变“已定向的”流的定向，fwide()没有出错返回，唯一可行的方法是调用fwide()时先清除errno，fwide()返回是检查errno的值。  
    打开一个流时，标准I/O函数fopen()返回一个指向FILE对象的指针(类型为FILE *， 称为文件指针)。FILE对象是一个结构，包含标准I/O库管理该“流”所需的所有信息，如：  
    * 用于实际I/O的文件描述符fd  
    * 指向该流缓冲区的指针  
    * 缓冲区的长度  
    * 当前在缓冲区中的字符数  
    * 出错标志  
    * 等等  

3. 标准输入、标准输出和标准出错    
    一个进程预定义以上三个**流**，这些流引用的文件与chapter3所用的文件描述符fd引用的文件相同。  
    这三个标准I/O流通过预定义文件指针stdin、stdout、stderr加以引用。三个文件指针定义在`<stdio.h>`。  

4. 缓冲  
    标准I/O库提供缓冲的目的：尽可能减少使用read和write调用的次数。      
    三种类型的缓冲：  
    （1）全缓冲。  
    （2）行缓冲。  
    （3）不带缓冲。  



<br>  

[返回主目录]: /2014/09/22/notes-of-apue.html
